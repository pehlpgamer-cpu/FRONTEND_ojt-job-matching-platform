<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <title>Document</title>
</head>
<body class="bg-white">
    
    <main class="w-screen h-screen flex justify-center items-center">
        
        <form id="loginForm" class="flex flex-col border p-4 rounded-lg">
            <span>
                <i class="bi bi-person-circle"></i>
                <label>Email</label>
            </span>
            <input required class="border p-1.5 rounded-md" type="text" id="emailInput" name="emailInput"/>
            
            <span>
                <i class="bi bi-lock-fill"></i>
                <label>Password</label>
            </span>
            <span class="flex">
                <input required class="grow border p-1.5 rounded-l-md" type="password" id="passwordInput" name="passwordInput"/>
                <button onclick="" class="p-1.5 border border-l-0 rounded-r-md" type="button">view</button>
            </span>
            

            <button id="btnLogin" class="mt-2 pt-3 pb-3 border rounded-md hover:bg-black hover:text-white hover:scale-105 duration-150" type="submit">
                Login
            </button>
            <a href="./register.html" class="text-blue-700 underline self-center">create an account?</a> 
            <a href="./products.html" class="text-blue-700 underline self-center">Continue as guest (student profile)</a>
        </form>
    </main>

    <script>
        const baseUrl = "http://127.0.0.1:8000/api"; 

        document.getElementById("loginForm").addEventListener("submit", async (e) => {
            e.preventDefault(); // Prevent default form submission
            
            const email = document.getElementById("emailInput").value;
            const password = document.getElementById("passwordInput").value;

            try {
                const response = await fetch(`${baseUrl}/v1/login`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ email, password })
                });

                if (!response.ok) {
                    const error = await response.json();
                    alert("Login failed: " + (error.message || ""));
                    return;
                }

                const data = await response.json();
                const token = data.token;

                sessionStorage.setItem("token", token);
                alert("Logged in!");
                redirectUser();

            } catch (err) {
                console.error(err);
            }
        });


        function redirectUser()
        {
            // if admin
            // else if student
            // else if company
            // else = 404 page

            window.location.assign("../admin/user_management.html"); // dashboard WIP
        }
    </script>


</body>
</html>